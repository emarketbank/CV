:root {
    --ai-primary: #00F0FF;
    --ai-secondary: #7000FF;
    --ai-bg: rgba(8, 10, 15, 0.85); /* More transparent for glass feel */
    --ai-glass: rgba(255, 255, 255, 0.03);
    --ai-border: rgba(255, 255, 255, 0.15);
}

/* --- Neural Core Trigger (Launcher) --- */
.ai-core-trigger {
    position: fixed;
    bottom: 30px;
    right: 30px; /* ALWAYS RIGHT */
    left: auto !important; /* Force override any RTL flips */
    width: 65px; /* Slightly larger */
    height: 65px;
    z-index: 10005;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
}

.core-node {
    position: relative;
    width: 100%;
    height: 100%;
    background: rgba(10, 10, 15, 0.8);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--ai-primary);
    font-size: 1.4rem;
    z-index: 2;
    border: 1px solid var(--ai-border);
    transition: all 0.4s ease;
    box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(0, 240, 255, 0.1),
        inset 0 0 20px rgba(0, 240, 255, 0.1);
    backdrop-filter: blur(10px);
    overflow: hidden;
}

/* Agent Avatar Image in Launcher */
.core-node img {
    width: 90%;
    height: 90%;
    object-fit: contain;
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.ai-core-trigger:hover .core-node img {
    transform: scale(1.1) translateY(-2px);
}

.core-orbit {
    position: absolute;
    inset: -6px;
    border: 1px dashed var(--ai-primary);
    border-radius: 50%;
    opacity: 0.4;
    animation: rotateOrbit 20s linear infinite;
    pointer-events: none;
}

.core-pulse {
    position: absolute;
    inset: 0;
    background: var(--ai-primary);
    border-radius: 50%;
    opacity: 0;
    filter: blur(20px);
    transition: all 0.4s ease;
    z-index: -1;
}

.ai-core-trigger:hover .core-node {
    border-color: var(--ai-primary);
    box-shadow: 0 0 40px rgba(0, 240, 255, 0.4);
}

.ai-core-trigger:hover .core-pulse {
    opacity: 0.4;
    transform: scale(1.4);
}

/* --- Chat Container --- */
.ai-chat-container {
    position: fixed;
    bottom: 110px;
    right: 30px; /* ALWAYS RIGHT */
    left: auto !important;
    width: 380px;
    max-width: calc(100vw - 60px);
    height: 600px;
    max-height: calc(100vh - 140px);
    background: var(--ai-bg);
    backdrop-filter: blur(40px) saturate(180%);
    -webkit-backdrop-filter: blur(40px) saturate(180%);
    border-radius: 24px;
    border: 1px solid var(--ai-border);
    z-index: 10004;
    display: flex;
    flex-direction: column;
    transform: translateY(20px) scale(0.95);
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); /* Bouncy enter */
    box-shadow: 
        0 30px 80px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(255, 255, 255, 0.1);
    overflow: hidden;
}

.ai-chat-container.active {
    transform: translateY(0) scale(1);
    opacity: 1;
    visibility: visible;
}

/* Header */
.ai-chat-header {
    padding: 15px 20px;
    position: relative;
    display: flex;
    align-items: center;
    gap: 15px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    background: rgba(255,255,255,0.02);
}

.ai-avatar-wrap {
    position: relative;
    width: 44px;
    height: 44px;
}

.ai-avatar-inner {
    width: 100%;
    height: 100%;
    border-radius: 50%; /* Circle avatar */
    overflow: hidden;
    border: 2px solid rgba(0, 240, 255, 0.3);
    box-shadow: 0 0 15px rgba(0, 240, 255, 0.2);
    background: #000;
}

.ai-avatar-inner img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.ai-status-dot {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 12px;
    height: 12px;
    background: #00FF66;
    border: 2px solid var(--ai-bg);
    border-radius: 50%;
    box-shadow: 0 0 5px #00FF66;
}

.ai-info h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 700;
    color: #fff;
    font-family: 'Outfit', sans-serif;
}

.ai-info span {
    font-size: 0.75rem;
    color: var(--ai-primary);
    font-weight: 500;
    letter-spacing: 0.5px;
    text-shadow: 0 0 10px rgba(0, 240, 255, 0.3);
}

.ai-close {
    margin-left: auto;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    color: #fff;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
}

.ai-close:hover {
    background: rgba(255, 50, 50, 0.2);
    border-color: rgba(255, 50, 50, 0.4);
    transform: rotate(90deg);
}

/* Messages */
.ai-chat-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
    scroll-behavior: smooth;
}

.message {
    display: flex;
    flex-direction: column;
    gap: 4px;
    max-width: 85%;
    animation: msgPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes msgPop {
    from { opacity: 0; transform: translateY(10px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

.msg-content {
    padding: 12px 16px;
    font-size: 0.92rem;
    line-height: 1.5;
    position: relative;
}

/* AI Message Bubble */
.ai-msg .msg-content {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.08);
    color: #e0e0e0;
    border-radius: 16px 16px 16px 4px;
}

/* User Message Bubble */
.user-msg {
    align-self: flex-end;
}

.user-msg .msg-content {
    background: linear-gradient(135deg, var(--ai-primary), #00A3FF);
    color: #000;
    font-weight: 600;
    border-radius: 16px 16px 4px 16px;
    box-shadow: 0 5px 15px rgba(0, 240, 255, 0.2);
}

.msg-time {
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.3);
    margin-left: 5px;
}

/* Input Area */
.ai-chat-input-area {
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-top: 1px solid rgba(255, 255, 255, 0.08);
}

.ai-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    gap: 10px;
}

.ai-input-wrapper input {
    flex: 1;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 12px 15px;
    border-radius: 12px;
    color: #fff;
    font-size: 0.9rem;
    outline: none;
    transition: all 0.3s;
}

.ai-input-wrapper input:focus {
    background: rgba(255, 255, 255, 0.08);
    border-color: var(--ai-primary);
    box-shadow: 0 0 15px rgba(0, 240, 255, 0.1);
}

.ai-input-wrapper button {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    border: none;
    background: var(--ai-primary);
    color: #000;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 0 10px rgba(0, 240, 255, 0.2);
}

.ai-input-wrapper button:hover {
    transform: scale(1.05);
    background: #fff;
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
}

/* Scrollbar */
.ai-chat-messages::-webkit-scrollbar {
    width: 4px;
}
.ai-chat-messages::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

/* Typing Indicator Animation */
.ai-msg .typing-dots {
    display: flex;
    gap: 4px;
    padding: 10px 14px;
    align-items: center;
}

.ai-msg .typing-dots span {
    width: 6px;
    height: 6px;
    background: var(--ai-primary);
    border-radius: 50%;
    display: block;
    animation: typingBounce 1.4s infinite ease-in-out both;
}

.ai-msg .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
.ai-msg .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes typingBounce {
    0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
    40% { transform: scale(1); opacity: 1; }
}

/* Reset for RTL pages to keep it on the Right */
html[lang="ar"] .ai-chat-container,
html[lang="ar"] .ai-core-trigger {
    right: 30px !important;
    left: auto !important;
}

/* If the close button needs to be on left in RTL header, we can allow that, 
   but usually consistency is better. Let's keep close on right for now or flip it. 
   Actually, standard is start or end. Let's force LTR layout for the header to keep controls consistent 
   OR let flexbox handle it but ensure the container stays right. */
   
html[lang="ar"] .ai-chat-header {
    flex-direction: row; /* Keep standard direction even in AR? 
                            No, better to let it flip content but keep container position right. */
}

/* Override close button margin for RTL if direction is rtl */
html[lang="ar"] .ai-close {
    margin-right: auto;
    margin-left: 0;
}